---
import Layout from '../layouts/Layout.astro';
import AnalysisChart from '../components/AnalysisChart.astro';
import { getCsvData } from '../data/csvDataJson.js';

// äº‹æ¥­æ‰€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
const businessBeforeData = getCsvData('business_before.csv');
const businessAfterData = getCsvData('business_after.csv');

// å¹³å‡æ™‚é–“ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
const calculateAverageTime = (data, key) => {
  if (!data || data.length === 0) return 0;
  const sum = data.reduce((acc, row) => acc + (parseInt(row[key]) || 0), 0);
  return Math.round(sum / data.length);
};

// å„æŒ‡æ¨™ã®å¹³å‡æ™‚é–“ã‚’è¨ˆç®—
const beforeAvgCreationTime = calculateAverageTime(businessBeforeData, '1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰');
const afterAvgCreationTime = calculateAverageTime(businessAfterData, '1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰');
const beforeAvgConfirmationTime = calculateAverageTime(businessBeforeData, '1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰');
const afterAvgConfirmationTime = calculateAverageTime(businessAfterData, '1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰');
const beforeAvgModificationTime = calculateAverageTime(businessBeforeData, 'åˆ©ç”¨è€…ã‹ã‚‰ã®ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‚’å—ã‘ã¦ã‹ã‚‰ä¿®æ­£å®Œäº†ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰');
const afterAvgModificationTime = calculateAverageTime(businessAfterData, 'åˆ©ç”¨è€…ã‹ã‚‰ã®ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‚’å—ã‘ã¦ã‹ã‚‰ä¿®æ­£å®Œäº†ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰');

// å‰Šæ¸›æ™‚é–“ã®è¨ˆç®—
const creationTimeReduction = beforeAvgCreationTime - afterAvgCreationTime;
const creationTimeReductionPercent = beforeAvgCreationTime > 0 ? Math.round((creationTimeReduction / beforeAvgCreationTime) * 100) : 0;

const confirmationTimeReduction = beforeAvgConfirmationTime - afterAvgConfirmationTime;
const confirmationTimeReductionPercent = beforeAvgConfirmationTime > 0 ? Math.round((confirmationTimeReduction / beforeAvgConfirmationTime) * 100) : 0;

const modificationTimeReduction = beforeAvgModificationTime - afterAvgModificationTime;
const modificationTimeReductionPercent = beforeAvgModificationTime > 0 ? Math.round((modificationTimeReduction / beforeAvgModificationTime) * 100) : 0;

// ç·åˆçš„ãªæ™‚é–“å‰Šæ¸›åŠ¹æœï¼ˆæœˆé–“ï¼‰
const totalMonthlyTimeSaved = creationTimeReduction + confirmationTimeReduction + modificationTimeReduction;
const totalBeforeTime = beforeAvgCreationTime + beforeAvgConfirmationTime + beforeAvgModificationTime;
const totalTimeReductionPercent = totalBeforeTime > 0 ? Math.round((totalMonthlyTimeSaved / totalBeforeTime) * 100) : 0;

// å¹´é–“å‰Šæ¸›æ™‚é–“ã‚’è¨ˆç®—
const annualTimeSaved = totalMonthlyTimeSaved * 12;
const annualHours = Math.floor(annualTimeSaved / 60);
const annualMinutes = annualTimeSaved % 60;

// äº‹æ¥­æ‰€è¦æ¨¡ã”ã¨ã®å¹³å‡æ™‚é–“ã‚’è¨ˆç®—
const calculateAverageTimesByScale = (data) => {
  if (!data || data.length === 0) return {};
  
  const scales = [...new Set(data.map(row => row['äº‹æ¥­æ‰€è¦æ¨¡']))].filter(Boolean);
  const result = {};
  
  scales.forEach(scale => {
    const filteredData = data.filter(row => row['äº‹æ¥­æ‰€è¦æ¨¡'] === scale);
    if (filteredData.length === 0) return;
    
    const creationSum = filteredData.reduce((sum, row) => sum + (parseInt(row['1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰']) || 0), 0);
    const confirmationSum = filteredData.reduce((sum, row) => sum + (parseInt(row['1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰']) || 0), 0);
    
    result[scale] = {
      creation: Math.round(creationSum / filteredData.length),
      confirmation: Math.round(confirmationSum / filteredData.length),
      count: filteredData.length
    };
  });
  
  return result;
};

const beforeScaleTimes = calculateAverageTimesByScale(businessBeforeData);
const afterScaleTimes = calculateAverageTimesByScale(businessAfterData);

---

<Layout title="äº‹æ¥­æ‰€åˆ†æ | å®®å´çœŒã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ å°å…¥åŠ¹æœåˆ†æ">
  <main class="container">
    <section class="page-header">
      <div class="header-content">
        <h1>äº‹æ¥­æ‰€ãƒ¬ãƒ™ãƒ«ã§ã®å°å…¥åŠ¹æœåˆ†æ</h1>
        <p class="lead">
          ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥ã«ã‚ˆã‚‹äº‹æ¥­æ‰€å…¨ä½“ã®æ¥­å‹™åŠ¹ç‡åŒ–ã¨çµŒæ¸ˆåŠ¹æœã‚’åˆ†æã—ã€çµ„ç¹”ã¨ã—ã¦ã®å°å…¥ãƒ¡ãƒªãƒƒãƒˆã‚’å¯è¦–åŒ–ã—ã¦ã„ã¾ã™ã€‚
        </p>
        <div class="header-decoration">
          <div class="decoration-circle"></div>
          <div class="decoration-line"></div>
        </div>
      </div>
    </section>

    <section class="key-findings card">
      <h2><span class="icon">ğŸ“Š</span>ä¸»è¦ãªåˆ†æçµæœ</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-value">{annualHours}æ™‚é–“{annualMinutes}åˆ†</div>
          <div class="stat-label">å¹´é–“ç·å‰Šæ¸›æ™‚é–“</div>
          <div class="stat-description">äº‹æ¥­æ‰€å…¨ä½“ã§ã®å¹´é–“å‰Šæ¸›æ™‚é–“</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ’¹</div>
          <div class="stat-value">{new Intl.NumberFormat('ja-JP').format(annualTimeSaved * 2000)}å††</div>
          <div class="stat-label">å¹´é–“äººä»¶è²»å‰Šæ¸›</div>
          <div class="stat-description">æ™‚çµ¦2,000å††æ›ç®—</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-value">{totalTimeReductionPercent}%</div>
          <div class="stat-label">ç·åˆçš„ãªæ™‚é–“å‰Šæ¸›ç‡</div>
          <div class="stat-description">æœˆé–“å‰Šæ¸›æ™‚é–“ã®åˆè¨ˆ</div>
        </div>
      </div>
    </section>

    <section class="time-comparison card">
      <h2><span class="icon">â³</span>æ¥­å‹™åˆ¥æ™‚é–“æ¯”è¼ƒ</h2>
      
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>æ¥­å‹™å†…å®¹</th>
              <th>å°å…¥å‰</th>
              <th>å°å…¥å¾Œ</th>
              <th>å‰Šæ¸›æ™‚é–“</th>
              <th>å‰Šæ¸›ç‡</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="task-icon">ğŸ“</span> æä¾›ç¥¨ä½œæˆ</td>
              <td>{beforeAvgCreationTime}åˆ†</td>
              <td>{afterAvgCreationTime}åˆ†</td>
              <td>{creationTimeReduction}åˆ†</td>
              <td><span class="badge badge-success">{creationTimeReductionPercent}%</span></td>
            </tr>
            <tr>
              <td><span class="task-icon">ğŸ”</span> å®Ÿç¸¾ç¢ºèª</td>
              <td>{beforeAvgConfirmationTime}åˆ†</td>
              <td>{afterAvgConfirmationTime}åˆ†</td>
              <td>{confirmationTimeReduction}åˆ†</td>
              <td><span class="badge badge-success">{confirmationTimeReductionPercent}%</span></td>
            </tr>
            <tr>
              <td><span class="task-icon">âœï¸</span> ä¿®æ­£å¯¾å¿œ</td>
              <td>{beforeAvgModificationTime}åˆ†</td>
              <td>{afterAvgModificationTime}åˆ†</td>
              <td>{modificationTimeReduction}åˆ†</td>
              <td><span class="badge badge-success">{modificationTimeReductionPercent}%</span></td>
            </tr>
            <tr class="total-row">
              <td><span class="task-icon">ğŸ”„</span> åˆè¨ˆæ™‚é–“</td>
              <td>{totalBeforeTime}åˆ†</td>
              <td>{totalBeforeTime - totalMonthlyTimeSaved}åˆ†</td>
              <td>{totalMonthlyTimeSaved}åˆ†</td>
              <td><span class="badge badge-success">{totalTimeReductionPercent}%</span></td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="data-insights">
        <div class="insight-card">
          <div class="insight-icon">ğŸ’¡</div>
          <div class="insight-content">
            <h3>åˆ†æãƒã‚¤ãƒ³ãƒˆ</h3>
            <p>ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã«ã‚ˆã‚Šã€æä¾›ç¥¨ä½œæˆã¨å®Ÿç¸¾ç¢ºèªã®ä¸¡æ–¹ã§å¤§å¹…ãªæ™‚é–“å‰Šæ¸›ãŒå®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«ä¿®æ­£å¯¾å¿œæ™‚é–“ã®çŸ­ç¸®ã¯ã€æƒ…å ±å…±æœ‰ã®è¿…é€ŸåŒ–ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚</p>
          </div>
        </div>
      </div>
    </section>

    <section class="chart-section card">
      <h2><span class="icon">ğŸ“Š</span>å…±æœ‰æ–¹æ³•åˆ¥ã®æ™‚é–“æ¯”è¼ƒ</h2>
      <div class="chart-grid">
        <div class="chart-container">
          <AnalysisChart 
            title="å°å…¥å‰ï¼šå…±æœ‰æ–¹æ³•åˆ¥å¹³å‡æ™‚é–“" 
            type="sharingMethod"
            data={businessBeforeData}
          />
        </div>
        <div class="chart-container">
          <AnalysisChart 
            title="å°å…¥å¾Œï¼šå…±æœ‰æ–¹æ³•åˆ¥å¹³å‡æ™‚é–“" 
            type="sharingMethod"
            data={businessAfterData}
          />
        </div>
      </div>
      
      <div class="chart-insights">
        <h3>åˆ†æçµæœã®ãƒã‚¤ãƒ³ãƒˆ</h3>
        <ul>
          <li><strong>ã‚·ã‚¹ãƒ†ãƒ å°å…¥åŠ¹æœï¼š</strong> ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹å…±æœ‰æ–¹æ³•ãŒæœ€ã‚‚åŠ¹ç‡çš„ã§ã€äº‹æ¥­æ‰€å…¨ä½“ã§ã®æ¥­å‹™æ™‚é–“å‰Šæ¸›ã«å¤§ããè²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚</li>
          <li><strong>ã‚³ã‚¹ãƒˆå‰Šæ¸›åŠ¹æœï¼š</strong> æ¥­å‹™æ™‚é–“ã®å‰Šæ¸›ã¯ç›´æ¥çš„ãªäººä»¶è²»å‰Šæ¸›ã«ã¤ãªãŒã‚Šã€å¹´é–“ç´„{new Intl.NumberFormat('ja-JP').format(annualTimeSaved * 2000)}å††ã®çµŒæ¸ˆåŠ¹æœãŒè¦‹è¾¼ã¾ã‚Œã¾ã™ã€‚</li>
        </ul>
      </div>
    </section>

    <section class="chart-section card">
      <h2><span class="icon">ğŸ“Š</span>äº‹æ¥­æ‰€è¦æ¨¡åˆ¥ã®æ™‚é–“æ¯”è¼ƒ</h2>
      <div class="chart-grid">
        <div class="chart-container">
          <AnalysisChart 
            title="å°å…¥å‰ï¼šäº‹æ¥­æ‰€è¦æ¨¡åˆ¥å¹³å‡æ™‚é–“" 
            type="businessScale"
            data={businessBeforeData}
          />
        </div>
        <div class="chart-container">
          <AnalysisChart 
            title="å°å…¥å¾Œï¼šäº‹æ¥­æ‰€è¦æ¨¡åˆ¥å¹³å‡æ™‚é–“" 
            type="businessScale"
            data={businessAfterData}
          />
        </div>
      </div>
      
      <div class="chart-insights">
        <h3>äº‹æ¥­æ‰€è¦æ¨¡åˆ¥ã®åˆ†æãƒã‚¤ãƒ³ãƒˆ</h3>
        <ul>
          <li><strong>è¦æ¨¡åˆ¥ã®åŠ¹æœå·®ï¼š</strong> äº‹æ¥­æ‰€è¦æ¨¡ã«ã‚ˆã£ã¦å°å…¥åŠ¹æœã«å·®ãŒã‚ã‚Šã€ç‰¹ã«ä¸­è¦æ¨¡äº‹æ¥­æ‰€ã§ã®æ™‚é–“å‰Šæ¸›åŠ¹æœãŒé¡•è‘—ã§ã™ã€‚</li>
          <li><strong>å¤§è¦æ¨¡äº‹æ¥­æ‰€ã®åŠ¹ç‡åŒ–ï¼š</strong> åˆ©ç”¨è€…æ•°ã®å¤šã„å¤§è¦æ¨¡äº‹æ¥­æ‰€ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã«ã‚ˆã‚‹æƒ…å ±å…±æœ‰ã®åŠ¹ç‡åŒ–ãŒã‚ˆã‚Šå¤§ããªåŠ¹æœã‚’ã‚‚ãŸã‚‰ã—ã¦ã„ã¾ã™ã€‚</li>
        </ul>
      </div>
    </section>

    <section class="roi-analysis card">
      <h2><span class="icon">ğŸ’°</span>æŠ•è³‡å¯¾åŠ¹æœï¼ˆROIï¼‰åˆ†æ</h2>
      <div class="roi-content">
        <div class="roi-intro">
          <p>
            ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥ã«ã‚ˆã‚‹æŠ•è³‡å¯¾åŠ¹æœã‚’åˆ†æã—ã¾ã—ãŸã€‚
          </p>
        </div>
        
        <div class="roi-grid">
          <div class="roi-item">
            <div class="roi-item-header">
              <div class="roi-icon">ğŸ”§</div>
              <h3>åˆæœŸæŠ•è³‡ã‚³ã‚¹ãƒˆ</h3>
            </div>
            <ul>
              <li>ã‚·ã‚¹ãƒ†ãƒ å°å…¥è²»ç”¨</li>
              <li>ç ”ä¿®ãƒ»æ•™è‚²è²»ç”¨</li>
              <li>ç§»è¡ŒæœŸé–“ã®æ¥­å‹™èª¿æ•´ã‚³ã‚¹ãƒˆ</li>
            </ul>
          </div>
          
          <div class="roi-item">
            <div class="roi-item-header">
              <div class="roi-icon">â±ï¸</div>
              <h3>ç¶™ç¶šçš„ã‚³ã‚¹ãƒˆ</h3>
            </div>
            <ul>
              <li>ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™ï¼ˆæœˆé¡/å¹´é¡ï¼‰</li>
              <li>ä¿å®ˆãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è²»ç”¨</li>
              <li>å®šæœŸçš„ãªç ”ä¿®è²»ç”¨</li>
            </ul>
          </div>
          
          <div class="roi-item">
            <div class="roi-item-header">
              <div class="roi-icon">ğŸ’¹</div>
              <h3>çµŒæ¸ˆçš„ãƒ¡ãƒªãƒƒãƒˆ</h3>
            </div>
            <ul>
              <li>å¹´é–“äººä»¶è²»å‰Šæ¸›ï¼šç´„{new Intl.NumberFormat('ja-JP').format(annualTimeSaved * 2000)}å††</li>
              <li>ç´™è³‡æºãƒ»å°åˆ·ã‚³ã‚¹ãƒˆå‰Šæ¸›</li>
              <li>ä¿ç®¡ã‚¹ãƒšãƒ¼ã‚¹å‰Šæ¸›</li>
            </ul>
          </div>
          
          <div class="roi-item">
            <div class="roi-item-header">
              <div class="roi-icon">âœ¨</div>
              <h3>éçµŒæ¸ˆçš„ãƒ¡ãƒªãƒƒãƒˆ</h3>
            </div>
            <ul>
              <li>æƒ…å ±å…±æœ‰ã®æ­£ç¢ºæ€§å‘ä¸Š</li>
              <li>åˆ©ç”¨è€…ã‚µãƒ¼ãƒ“ã‚¹ã®è³ªå‘ä¸Š</li>
              <li>ã‚¹ã‚¿ãƒƒãƒ•ã®æ¥­å‹™æº€è¶³åº¦å‘ä¸Š</li>
            </ul>
          </div>
        </div>
        
        <div class="roi-summary">
          <div class="roi-summary-item">
            <div class="roi-summary-icon">â³</div>
            <div class="roi-summary-content">
              <p>
                <strong>æŠ•è³‡å›åæœŸé–“ï¼š</strong> å°å…¥ã‚³ã‚¹ãƒˆã¨å¹´é–“å‰Šæ¸›é¡ã‚’è€ƒæ…®ã™ã‚‹ã¨ã€ç´„1ã€œ2å¹´ã§ã®æŠ•è³‡å›åãŒè¦‹è¾¼ã¾ã‚Œã¾ã™ã€‚
              </p>
            </div>
          </div>
          <div class="roi-summary-item">
            <div class="roi-summary-icon">ğŸ“ˆ</div>
            <div class="roi-summary-content">
              <p>
                <strong>5å¹´é–“ã®ç´¯ç©åŠ¹æœï¼š</strong> 5å¹´é–“ã§ã®ç´¯ç©çµŒæ¸ˆåŠ¹æœã¯ç´„{new Intl.NumberFormat('ja-JP').format(annualTimeSaved * 2000 * 5)}å††ã¨è©¦ç®—ã•ã‚Œã¾ã™ã€‚
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="recommendations card">
      <h2><span class="icon">ğŸ’¡</span>äº‹æ¥­æ‰€å‘ã‘æ¨å¥¨äº‹é …</h2>
      <div class="recommendations-content">
        <ol class="recommendation-list">
          <li class="recommendation-item">
            <div class="recommendation-number">1</div>
            <div class="recommendation-content">
              <strong>æ®µéšçš„ãªå°å…¥è¨ˆç”»ã®ç­–å®šï¼š</strong> 
              ã‚·ã‚¹ãƒ†ãƒ å°å…¥ç‡ã‚’ã•ã‚‰ã«é«˜ã‚ã‚‹ãŸã‚ã€éƒ¨é–€ã”ã¨ã«æ®µéšçš„ãªå°å…¥è¨ˆç”»ã‚’ç­–å®šã—ã€æˆåŠŸäº‹ä¾‹ã‚’çµ„ç¹”å†…ã§å…±æœ‰ã™ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚
            </div>
          </li>
          <li class="recommendation-item">
            <div class="recommendation-number">2</div>
            <div class="recommendation-content">
              <strong>å®šæœŸçš„ãªåŠ¹æœæ¸¬å®šï¼š</strong> 
              å››åŠæœŸã”ã¨ã«æ¥­å‹™æ™‚é–“ã®æ¸¬å®šã‚’è¡Œã„ã€ã‚·ã‚¹ãƒ†ãƒ å°å…¥åŠ¹æœã‚’ç¶™ç¶šçš„ã«æ¤œè¨¼ãƒ»æ”¹å–„ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹åŠ¹ç‡åŒ–ãŒæœŸå¾…ã§ãã¾ã™ã€‚
            </div>
          </li>
          <li class="recommendation-item">
            <div class="recommendation-number">3</div>
            <div class="recommendation-content">
              <strong>æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–ï¼š</strong> 
              ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã«åˆã‚ã›ã¦æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹å…¨ä½“ã‚’è¦‹ç›´ã—ã€é‡è¤‡ä½œæ¥­ã®å‰Šæ¸›ã‚„æƒ…å ±å…±æœ‰ã®åŠ¹ç‡åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
            </div>
          </li>
          <li class="recommendation-item">
            <div class="recommendation-number">4</div>
            <div class="recommendation-content">
              <strong>ä»–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºå¼·åŒ–ï¼š</strong> 
              æ—¢å­˜ã®æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã‚’å¼·åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã®é‡è¤‡ã‚’é¿ã‘ã€ã•ã‚‰ãªã‚‹æ¥­å‹™åŠ¹ç‡åŒ–ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚
            </div>
          </li>
        </ol>
      </div>
    </section>

    <section class="navigation-links">
      <div class="nav-buttons">
        <a href="/" class="btn btn-primary">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        <a href="/individual/" class="btn btn-secondary">å€‹äººåˆ†æã‚’è¦‹ã‚‹</a>
      </div>
    </section>
  </main>
</Layout>

<script>
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§CSVãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateBusinessStatistics() {
    console.log('äº‹æ¥­æ‰€åˆ†æã®çµ±è¨ˆæƒ…å ±ã®æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã™...');
    
    // CSVãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    if (!window.__csvDataCache) {
      console.log('CSVãƒ‡ãƒ¼ã‚¿ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
      return;
    }
    
    const businessBeforeData = window.__csvDataCache['business_before.csv'];
    const businessAfterData = window.__csvDataCache['business_after.csv'];
    
    if (!businessBeforeData || !businessAfterData) {
      console.log('å¿…è¦ãªCSVãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    
    console.log(`ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: å°å…¥å‰=${businessBeforeData.length}ä»¶, å°å…¥å¾Œ=${businessAfterData.length}ä»¶`);
    
    // å¹³å‡æ™‚é–“ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
    const calculateAverageTime = (data, key) => {
      if (!data || data.length === 0) return 0;
      const sum = data.reduce((acc, row) => acc + (parseInt(row[key]) || 0), 0);
      return Math.round(sum / data.length);
    };
    
    // å„æŒ‡æ¨™ã®å¹³å‡æ™‚é–“ã‚’è¨ˆç®—
    const beforeAvgCreationTime = calculateAverageTime(businessBeforeData, '1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰');
    const afterAvgCreationTime = calculateAverageTime(businessAfterData, '1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰');
    const beforeAvgConfirmationTime = calculateAverageTime(businessBeforeData, '1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰');
    const afterAvgConfirmationTime = calculateAverageTime(businessAfterData, '1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰');
    const beforeAvgModificationTime = calculateAverageTime(businessBeforeData, 'åˆ©ç”¨è€…ã‹ã‚‰ã®ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‚’å—ã‘ã¦ã‹ã‚‰ä¿®æ­£å®Œäº†ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰');
    const afterAvgModificationTime = calculateAverageTime(businessAfterData, 'åˆ©ç”¨è€…ã‹ã‚‰ã®ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‚’å—ã‘ã¦ã‹ã‚‰ä¿®æ­£å®Œäº†ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰');
    
    // å‰Šæ¸›æ™‚é–“ã®è¨ˆç®—
    const creationTimeReduction = beforeAvgCreationTime - afterAvgCreationTime;
    const creationTimeReductionPercent = beforeAvgCreationTime > 0 ? Math.round((creationTimeReduction / beforeAvgCreationTime) * 100) : 0;
    
    const confirmationTimeReduction = beforeAvgConfirmationTime - afterAvgConfirmationTime;
    const confirmationTimeReductionPercent = beforeAvgConfirmationTime > 0 ? Math.round((confirmationTimeReduction / beforeAvgConfirmationTime) * 100) : 0;
    
    const modificationTimeReduction = beforeAvgModificationTime - afterAvgModificationTime;
    const modificationTimeReductionPercent = beforeAvgModificationTime > 0 ? Math.round((modificationTimeReduction / beforeAvgModificationTime) * 100) : 0;
    
    // ç·åˆçš„ãªæ™‚é–“å‰Šæ¸›åŠ¹æœï¼ˆæœˆé–“ï¼‰
    const totalMonthlyTimeSaved = creationTimeReduction + confirmationTimeReduction + modificationTimeReduction;
    const totalBeforeTime = beforeAvgCreationTime + beforeAvgConfirmationTime + beforeAvgModificationTime;
    const totalTimeReductionPercent = totalBeforeTime > 0 ? Math.round((totalMonthlyTimeSaved / totalBeforeTime) * 100) : 0;
    
    // å¹´é–“å‰Šæ¸›æ™‚é–“ã‚’è¨ˆç®—
    const annualTimeSaved = totalMonthlyTimeSaved * 12;
    const annualHours = Math.floor(annualTimeSaved / 60);
    const annualMinutes = annualTimeSaved % 60;
    
    // äº‹æ¥­æ‰€è¦æ¨¡ã”ã¨ã®å¹³å‡æ™‚é–“ã‚’è¨ˆç®—
    const calculateAverageTimesByScale = (data) => {
      if (!data || data.length === 0) return {};
      
      const scales = [...new Set(data.map(row => row['äº‹æ¥­æ‰€è¦æ¨¡']))].filter(Boolean);
      const result = {};
      
      scales.forEach(scale => {
        const filteredData = data.filter(row => row['äº‹æ¥­æ‰€è¦æ¨¡'] === scale);
        if (filteredData.length === 0) return;
        
        const creationSum = filteredData.reduce((sum, row) => sum + (parseInt(row['1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰']) || 0), 0);
        const confirmationSum = filteredData.reduce((sum, row) => sum + (parseInt(row['1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰']) || 0), 0);
        
        result[scale] = {
          creation: Math.round(creationSum / filteredData.length),
          confirmation: Math.round(confirmationSum / filteredData.length),
          count: filteredData.length
        };
      });
      
      return result;
    };
    
    // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
    // ä¸»è¦ãªåˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ›´æ–°
    const statValues = document.querySelectorAll('.stat-value');
    if (statValues.length >= 3) {
      // ç·æ¥­å‹™æ™‚é–“å‰Šæ¸›
      statValues[0].textContent = `${annualHours}æ™‚é–“${annualMinutes}åˆ†`;
      
      // å¹´é–“äººä»¶è²»å‰Šæ¸›
      statValues[1].textContent = `${new Intl.NumberFormat('ja-JP').format(annualTimeSaved * 2000)}å††`;
      
      // ç·åˆçš„ãªæ™‚é–“å‰Šæ¸›ç‡
      statValues[2].textContent = `${totalTimeReductionPercent}%`;
    }
    
    // æ¥­å‹™åˆ¥æ™‚é–“æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
    const tableRows = document.querySelectorAll('.comparison-table tbody tr');
    if (tableRows.length >= 4) {
      // æä¾›ç¥¨ä½œæˆæ™‚é–“ã®è¡Œ
      const creationRow = tableRows[0];
      if (creationRow) {
        creationRow.children[1].textContent = `${beforeAvgCreationTime}åˆ†`;
        creationRow.children[2].textContent = `${afterAvgCreationTime}åˆ†`;
        creationRow.children[3].textContent = `${creationTimeReduction}åˆ†`;
        creationRow.children[4].querySelector('.badge').textContent = `${creationTimeReductionPercent}%`;
      }
      
      // å®Ÿç¸¾ç¢ºèªæ™‚é–“ã®è¡Œ
      const confirmationRow = tableRows[1];
      if (confirmationRow) {
        confirmationRow.children[1].textContent = `${beforeAvgConfirmationTime}åˆ†`;
        confirmationRow.children[2].textContent = `${afterAvgConfirmationTime}åˆ†`;
        confirmationRow.children[3].textContent = `${confirmationTimeReduction}åˆ†`;
        confirmationRow.children[4].querySelector('.badge').textContent = `${confirmationTimeReductionPercent}%`;
      }
      
      // ä¿®æ­£å¯¾å¿œæ™‚é–“ã®è¡Œ
      const modificationRow = tableRows[2];
      if (modificationRow) {
        modificationRow.children[1].textContent = `${beforeAvgModificationTime}åˆ†`;
        modificationRow.children[2].textContent = `${afterAvgModificationTime}åˆ†`;
        modificationRow.children[3].textContent = `${modificationTimeReduction}åˆ†`;
        modificationRow.children[4].querySelector('.badge').textContent = `${modificationTimeReductionPercent}%`;
      }
      
      // åˆè¨ˆæ™‚é–“ã®è¡Œ
      const totalRow = tableRows[3];
      if (totalRow) {
        totalRow.children[1].textContent = `${totalBeforeTime}åˆ†`;
        totalRow.children[2].textContent = `${totalBeforeTime - totalMonthlyTimeSaved}åˆ†`;
        totalRow.children[3].textContent = `${totalMonthlyTimeSaved}åˆ†`;
        totalRow.children[4].querySelector('.badge').textContent = `${totalTimeReductionPercent}%`;
      }
    }
    
    // CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
    // ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã‚Šã€AnalysisChartã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã‚‹
    window.dispatchEvent(new CustomEvent('csv-data-loaded', {
      detail: {
        fileName: 'business_before.csv',
        data: businessBeforeData
      }
    }));
    
    window.dispatchEvent(new CustomEvent('csv-data-loaded', {
      detail: {
        fileName: 'business_after.csv',
        data: businessAfterData
      }
    }));
    
    console.log('äº‹æ¥­æ‰€åˆ†æã®çµ±è¨ˆæƒ…å ±ã®æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸ');
  }
  
  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«CSVãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ: CSVãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹ã—ã¾ã™');
    
    // bodyã«ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã€ã“ã®ãƒšãƒ¼ã‚¸ãŒäº‹æ¥­æ‰€åˆ†æãƒšãƒ¼ã‚¸ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
    document.querySelector('body').classList.add('business-page');
    
    // CSVãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
    if (window.__csvDataCache) {
      updateBusinessStatistics();
    }
    
    // CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒŠãƒ¼
    window.addEventListener('csv-data-loaded', function(event) {
      console.log('CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥:', event.detail.fileName);
      updateBusinessStatistics();
    });
  });
</script>

<style>
  .page-header {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
  }
  
  .header-content {
    position: relative;
    z-index: 2;
  }
  
  .header-decoration {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 1;
    overflow: hidden;
  }
  
  .decoration-circle {
    position: absolute;
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background-color: rgba(66, 153, 225, 0.1);
    top: -150px;
    right: -150px;
  }
  
  .decoration-line {
    position: absolute;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent, rgba(66, 153, 225, 0.2), transparent);
    bottom: 0;
  }
  
  h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1rem;
  }
  
  .lead {
    font-size: 1.25rem;
    color: #4a5568;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .card {
    background-color: white;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    margin-bottom: 2rem;
  }
  
  h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
  }
  
  .icon {
    margin-right: 0.5rem;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }
  
  .stat-card {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition: transform 0.3s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
  }
  
  .stat-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #3182ce;
    margin-bottom: 0.5rem;
  }
  
  .stat-label {
    font-size: 1rem;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.5rem;
  }
  
  .stat-description {
    font-size: 0.875rem;
    color: #718096;
  }
  
  .comparison-table {
    overflow-x: auto;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
  }
  
  th, td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
  }
  
  th {
    background-color: #f7fafc;
    font-weight: 600;
    color: #4a5568;
  }
  
  .task-icon {
    margin-right: 0.5rem;
  }
  
  .badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  
  .badge-success {
    background-color: #c6f6d5;
    color: #2f855a;
  }
  
  .total-row {
    font-weight: 600;
    background-color: #f7fafc;
  }
  
  .chart-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .chart-grid {
      grid-template-columns: 1fr 1fr;
    }
  }
  
  .chart-container {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1rem;
    height: 350px;
  }
  
  .chart-insights {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1.5rem;
  }
  
  .chart-insights h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1rem;
  }
  
  .chart-insights ul {
    padding-left: 1.5rem;
  }
  
  .chart-insights li {
    margin-bottom: 0.5rem;
  }
  
  .data-insights {
    margin-top: 1.5rem;
  }
  
  .insight-card {
    background-color: #ebf8ff;
    border-radius: 0.5rem;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
  }
  
  .insight-icon {
    font-size: 2rem;
    margin-right: 1rem;
  }
  
  .insight-content {
    flex: 1;
  }
  
  .insight-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c5282;
    margin-bottom: 0.5rem;
  }
  
  .insight-content p {
    color: #4a5568;
    margin: 0;
  }
  
  .roi-content {
    margin-bottom: 1.5rem;
  }
  
  .roi-summary {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .roi-summary-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1rem;
  }
  
  .roi-summary-content {
    color: #4a5568;
  }
  
  .roi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }
  
  .roi-card {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }
  
  .roi-card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1rem;
  }
  
  .roi-card-content {
    flex: 1;
    color: #4a5568;
  }
  
  .roi-card-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #3182ce;
    margin-top: 1rem;
  }
  
  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }
  
  .benefit-card {
    background-color: #f7fafc;
    border-radius: 0.5rem;
    padding: 1.5rem;
  }
  
  .benefit-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
  }
  
  .benefit-card-icon {
    margin-right: 0.5rem;
  }
  
  .benefit-card ul {
    padding-left: 1.5rem;
    margin-bottom: 0;
  }
  
  .benefit-card li {
    margin-bottom: 0.5rem;
  }
  
  .recommendation-list {
    counter-reset: recommendation-counter;
    list-style: none;
    padding: 0;
  }
  
  .recommendation-item {
    position: relative;
    padding-left: 3rem;
    margin-bottom: 1.5rem;
  }
  
  .recommendation-item::before {
    counter-increment: recommendation-counter;
    content: counter(recommendation-counter);
    position: absolute;
    left: 0;
    top: 0;
    width: 2rem;
    height: 2rem;
    background-color: #3182ce;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }
  
  .recommendation-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
  }
  
  .recommendation-content {
    color: #4a5568;
  }
  
  .navigation-links {
    margin-top: 3rem;
    margin-bottom: 2rem;
  }
  
  .nav-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  
  .btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn-primary {
    background-color: #3182ce;
    color: white;
    border: 2px solid #3182ce;
  }
  
  .btn-primary:hover {
    background-color: transparent;
    color: #3182ce;
  }
  
  .btn-secondary {
    background-color: transparent;
    color: #3182ce;
    border: 2px solid #3182ce;
  }
  
  .btn-secondary:hover {
    background-color: #3182ce;
    color: white;
  }
  
  @media (max-width: 768px) {
    .nav-buttons {
      flex-direction: column;
      align-items: center;
    }
    
    .stat-value {
      font-size: 1.75rem;
    }
    
    table {
      font-size: 0.875rem;
    }
    
    th, td {
      padding: 0.5rem;
    }
    
    .roi-grid {
      grid-template-columns: 1fr;
    }

    .recommendation-item {
      flex-direction: column;
    }

    .recommendation-number {
      margin-bottom: 1rem;
    }
  }
</style>
