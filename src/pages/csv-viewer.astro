---
import Layout from '../layouts/Layout.astro';
import { individualBeforeData, individualAfterData, businessBeforeData, businessAfterData } from '../data/csvDataJson.js';

// CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
const csvFiles = [
  { name: 'å€‹äººå°å…¥å‰', path: 'individual_before.csv' },
  { name: 'å€‹äººå°å…¥å¾Œ', path: 'individual_after.csv' },
  { name: 'äº‹æ¥­æ‰€å°å…¥å‰', path: 'business_before.csv' },
  { name: 'äº‹æ¥­æ‰€å°å…¥å¾Œ', path: 'business_after.csv' }
];

// å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const csvData = [
  individualBeforeData,
  individualAfterData,
  businessBeforeData,
  businessAfterData
];

// CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±
const csvFileInfo = {
  'individual_before.csv': {
    totalRows: individualBeforeData.length,
    description: 'å€‹äººå°å…¥å‰ãƒ‡ãƒ¼ã‚¿'
  },
  'individual_after.csv': {
    totalRows: individualAfterData.length,
    description: 'å€‹äººå°å…¥å¾Œãƒ‡ãƒ¼ã‚¿'
  },
  'business_before.csv': {
    totalRows: businessBeforeData.length,
    description: 'äº‹æ¥­æ‰€å°å…¥å‰ãƒ‡ãƒ¼ã‚¿'
  },
  'business_after.csv': {
    totalRows: businessAfterData.length,
    description: 'äº‹æ¥­æ‰€å°å…¥å¾Œãƒ‡ãƒ¼ã‚¿'
  }
};

// CSVãƒ‡ãƒ¼ã‚¿ã®æƒ…å ±ã‚’ç”Ÿæˆ
const csvInfos = csvFiles.map((file, index) => {
  const data = csvData[index];
  const headers = data.length > 0 ? Object.keys(data[0]) : [];
  
  return {
    name: file.name,
    path: file.path,
    info: {
      stats: {
        totalRows: data.length,
        validRows: data.filter(row => Object.values(row).some(val => val && val.trim && val.trim() !== '')).length,
        headerCount: headers.length,
        headers: headers
      },
      sampleData: data.slice(0, 5)
    }
  };
});

// ãƒ˜ãƒƒãƒ€ãƒ¼ã®èª¬æ˜ã‚’æä¾›ã™ã‚‹é–¢æ•°
function getHeaderDescription(header) {
  const descriptions = {
    'è¨˜å…¥è€…': 'ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ãŸæ‹…å½“è€…ã®åå‰',
    'è¨˜å…¥æ—¥': 'ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚ŒãŸæ—¥ä»˜',
    'åˆ©ç”¨è€…ID': 'ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è€…ã®è­˜åˆ¥ç•ªå·',
    'åˆ©ç”¨è€…å': 'ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è€…ã®æ°å',
    'äº‹æ¥­æ‰€ID': 'ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹æä¾›äº‹æ¥­æ‰€ã®è­˜åˆ¥ç•ªå·',
    'äº‹æ¥­æ‰€å': 'ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹æä¾›äº‹æ¥­æ‰€ã®åç§°',
    'é–‹å§‹æ™‚é–“': 'æ¥­å‹™ã®é–‹å§‹æ™‚åˆ»',
    'çµ‚äº†æ™‚é–“': 'æ¥­å‹™ã®çµ‚äº†æ™‚åˆ»',
    'æ‰€è¦æ™‚é–“': 'æ¥­å‹™ã®å®Ÿæ–½ã«è¦ã—ãŸæ™‚é–“ï¼ˆåˆ†ï¼‰',
    'æ¥­å‹™åˆ†é¡': 'å®Ÿæ–½ã—ãŸæ¥­å‹™ã®ã‚«ãƒ†ã‚´ãƒª',
    'æ¥­å‹™å†…å®¹': 'å®Ÿæ–½ã—ãŸæ¥­å‹™ã®è©³ç´°å†…å®¹',
    'æ¥­å‹™è©³ç´°': 'æ¥­å‹™ã«é–¢ã™ã‚‹è¿½åŠ æƒ…å ±',
    'ç§»å‹•æ‰‹æ®µ': 'æ¥­å‹™ã®ãŸã‚ã«ä½¿ç”¨ã—ãŸç§»å‹•æ–¹æ³•',
    'ç§»å‹•æ™‚é–“': 'ç§»å‹•ã«è¦ã—ãŸæ™‚é–“ï¼ˆåˆ†ï¼‰',
    'å‚™è€ƒ': 'è¿½åŠ ã®æ³¨é‡ˆã‚„ç‰¹è¨˜äº‹é …',
    '1ãƒ¶æœˆã‚ãŸã‚Šã®æä¾›ç¥¨ä½œæˆæ™‚é–“ï¼ˆåˆ†ï¼‰': '1ãƒ¶æœˆé–“ã«æä¾›ç¥¨ã‚’ä½œæˆã™ã‚‹ã®ã«è¦ã™ã‚‹å¹³å‡æ™‚é–“',
    '1ãƒ¶æœˆã‚ãŸã‚Šã®å®Ÿç¸¾ç¢ºèªæ™‚é–“ï¼ˆåˆ†ï¼‰': '1ãƒ¶æœˆé–“ã«å®Ÿç¸¾ã‚’ç¢ºèªã™ã‚‹ã®ã«è¦ã™ã‚‹å¹³å‡æ™‚é–“',
    'åˆ©ç”¨è€…ã‹ã‚‰ã®ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‚’å—ã‘ã¦ã‹ã‚‰ä¿®æ­£å®Œäº†ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰': 'ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¿®æ­£ä¾é ¼ã‹ã‚‰å®Œäº†ã¾ã§ã®å¹³å‡æ‰€è¦æ™‚é–“',
    'ã‚±ã‚¢ãƒ—ãƒ©ãƒ³å…±æœ‰æ–¹æ³•': 'ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ã‚’é–¢ä¿‚è€…ã¨å…±æœ‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã‚‹æ–¹æ³•',
    'å…±æœ‰æ–¹æ³•': 'ãƒ‡ãƒ¼ã‚¿ã‚„æƒ…å ±ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã‚‹æ–¹æ³•',
    'ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨ç‡': 'ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å‰²åˆï¼ˆ%ï¼‰'
  };
  
  return descriptions[header] || `${header}ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿`;
}
---

<Layout title="CSVãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚¢ | å®®å´ã‚±ã‚¢ãƒ—ãƒ©ãƒ³åˆ†æ">
  <main class="container">
    <section class="page-header">
      <h1>CSVãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚¢</h1>
      <p class="lead">
        åˆ†æã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹CSVãƒ‡ãƒ¼ã‚¿ã®å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨å†…å®¹ã‚’è¦–è¦šçš„ã«è¡¨ç¤ºã—ã¾ã™ã€‚
      </p>
    </section>
    
    <div class="file-tabs">
      {csvFiles.map((file, index) => (
        <button class={`file-button ${index === 0 ? 'active' : ''}`} data-index={index}>
          {file.name}
        </button>
      ))}
    </div>
    
    {csvInfos.map((csvInfo, fileIndex) => (
      <div id={`file-${fileIndex}`} class="csv-info-container" style={fileIndex === 0 ? "" : "display: none;"}>
        <div class="file-header card">
          <h2>{csvInfo.name} ({csvInfo.path})</h2>
          <div class="file-description">
            <p>ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯{csvInfo.name.includes('å€‹äºº') ? 'å€‹äººãƒ¬ãƒ™ãƒ«' : 'äº‹æ¥­æ‰€ãƒ¬ãƒ™ãƒ«'}ã§ã®{csvInfo.name.includes('å°å…¥å‰') ? 'ã‚·ã‚¹ãƒ†ãƒ å°å…¥å‰' : 'ã‚·ã‚¹ãƒ†ãƒ å°å…¥å¾Œ'}ã®æƒ…å ±ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚</p>
            <p>{csvFileInfo[csvInfo.path].description}</p>
          </div>
          
          <div class="file-stats">
            <div class="stat-item">
              <div class="stat-value" id={`total-rows-${fileIndex}`}>{csvInfo.info.stats.totalRows}</div>
              <div class="stat-label">ç·è¡Œæ•°</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id={`valid-rows-${fileIndex}`}>{csvInfo.info.stats.validRows}</div>
              <div class="stat-label">æœ‰åŠ¹è¡Œæ•°</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id={`header-count-${fileIndex}`}>{csvInfo.info.stats.headerCount}</div>
              <div class="stat-label">é …ç›®æ•°</div>
            </div>
          </div>
        </div>
        
        <div class="header-stats-card card">
          <h3><span class="icon">ğŸ”</span>ãƒ‡ãƒ¼ã‚¿é …ç›®ã®èª¬æ˜</h3>
          <div class="header-grid">
            {csvInfo.info.stats.headers.map((header, index) => (
              <div class="header-item">
                <div class="header-name">{header}</div>
                <div class="header-description">{getHeaderDescription(header)}</div>
              </div>
            ))}
          </div>
        </div>
        
        <div class="sample-data-card card">
          <h3><span class="icon">ğŸ“‹</span>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</h3>
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr id={`header-row-${fileIndex}`}>
                  {csvInfo.info.stats.headers.map(header => (
                    <th>{header}</th>
                  ))}
                </tr>
              </thead>
              <tbody id={`sample-data-${fileIndex}`}>
                {csvInfo.info.sampleData.map(row => (
                  <tr>
                    {csvInfo.info.stats.headers.map(header => (
                      <td>{row[header] || ''}</td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="card">
          <h3><span class="icon">ğŸ“Š</span>ãƒ‡ãƒ¼ã‚¿åˆ†æ</h3>
          <p>ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ã€{csvInfo.name.includes('å€‹äºº') ? 'å€‹äººã‚±ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' : 'äº‹æ¥­æ‰€'}ã®{csvInfo.name.includes('å°å…¥å‰') ? 'ã‚·ã‚¹ãƒ†ãƒ å°å…¥å‰' : 'ã‚·ã‚¹ãƒ†ãƒ å°å…¥å¾Œ'}ã®æ¥­å‹™åŠ¹ç‡ã‚’åˆ†æã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
          
          <div class="analysis-actions">
            <a href={csvInfo.name.includes('å€‹äºº') ? '/individual' : '/business'} class="btn-primary">
              <span class="btn-icon">ğŸ“ˆ</span>è©³ç´°åˆ†æã‚’è¦‹ã‚‹
            </a>
            <a href="/" class="btn-secondary">
              <span class="btn-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </a>
          </div>
        </div>
      </div>
    ))}
  </main>
</Layout>

<script is:inline>
  // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ã®å‹•ä½œ
  window.addEventListener('load', function() {
    const fileButtons = document.querySelectorAll('.file-button');
    const fileContainers = document.querySelectorAll('.csv-info-container');
    
    fileButtons.forEach((button, index) => {
      button.addEventListener('click', () => {
        // ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤ºã«ã™ã‚‹
        fileContainers.forEach(container => {
          container.style.display = 'none';
        });
        
        // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤ºã™ã‚‹
        fileContainers[index].style.display = 'block';
        
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
        fileButtons.forEach(btn => {
          btn.classList.remove('active');
        });
        button.classList.add('active');
      });
    });
  });
</script>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
  }
  
  .page-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 2rem 0;
  }
  
  .lead {
    font-size: 1.125rem;
    color: var(--text-secondary);
    max-width: 800px;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  .card {
    background-color: var(--bg-secondary);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 1.5rem;
    margin-bottom: 2rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
    position: relative;
  }
  
  .card h2, .card h3 {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
    color: var(--accent);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.75rem;
  }
  
  .icon {
    margin-right: 0.5rem;
    font-size: 1.25rem;
  }
  
  .file-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 2rem;
    justify-content: center;
  }
  
  .file-button {
    background-color: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .file-button:hover {
    background-color: var(--bg-hover);
    transform: translateY(-2px);
  }
  
  .file-button.active {
    background-color: var(--accent);
    color: white;
    border-color: var(--accent);
  }
  
  .file-header {
    position: relative;
    overflow: hidden;
  }
  
  .file-header::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 100px;
    background-color: var(--accent);
    opacity: 0.1;
    border-radius: 50%;
    transform: translate(30%, -30%);
  }
  
  .file-description {
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  
  .file-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    margin-top: 1.5rem;
  }
  
  .stat-item {
    text-align: center;
    flex: 1;
    min-width: 100px;
    padding: 1rem;
    background-color: var(--bg-primary);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-sm);
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
  }
  
  .stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
  
  .header-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
  }
  
  .header-item {
    background-color: var(--bg-primary);
    padding: 1rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-sm);
    transition: transform 0.3s ease;
  }
  
  .header-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--box-shadow);
  }
  
  .header-name {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--accent);
  }
  
  .header-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }
  
  .table-responsive {
    overflow-x: auto;
    margin-bottom: 1rem;
  }
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
  }
  
  .data-table th, .data-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
  }
  
  .data-table th {
    background-color: var(--bg-primary);
    font-weight: 600;
    color: var(--accent);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .data-table tr:hover {
    background-color: var(--bg-hover);
  }
  
  .analysis-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  
  .btn-primary, .btn-secondary {
    display: inline-flex;
    align-items: center;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }
  
  .btn-primary {
    background-color: var(--accent);
    color: white;
  }
  
  .btn-primary:hover {
    background-color: var(--accent-dark);
    transform: translateY(-2px);
  }
  
  .btn-secondary {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
  }
  
  .btn-secondary:hover {
    background-color: var(--accent);
    color: white;
  }
  
  .error-message {
    background-color: #fff5f5;
    border-left: 4px solid #f56565;
    color: #c53030;
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
  }
  
  .error-message p {
    margin: 0.5rem 0;
  }
  
  .error-message strong {
    font-weight: 600;
  }
  
  @media (max-width: 768px) {
    .file-tabs {
      flex-direction: column;
    }
    
    .file-button {
      width: 100%;
    }
    
    .file-stats {
      flex-direction: column;
      gap: 1rem;
    }
    
    .header-grid {
      grid-template-columns: 1fr;
    }
    
    .analysis-actions {
      flex-direction: column;
    }
    
    .btn-primary, .btn-secondary {
      width: 100%;
      justify-content: center;
    }
  }
</style>
